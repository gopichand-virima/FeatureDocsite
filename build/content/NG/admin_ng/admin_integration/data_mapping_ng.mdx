# Data Mapping

Use this function to configure field mappings and data transformations between Virima and external systems.

Data mapping ensures that information flows correctly between systems by defining how fields correspond and how values should be transformed during integration.

In the main window, click **Admin > Integration > Data Mapping**. The Data Mapping window displays.

## Overview

Data mapping provides:

- Field-to-field mapping between systems
- Value transformation and conversion
- Data type mapping
- Custom field mapping
- Conditional mapping rules
- Bi-directional mapping support

## Mapping List

View all configured mappings:

**Mapping Columns**:

- **Mapping Name**: Descriptive name
- **Integration**: Associated integration
- **Source System**: Origin system
- **Target System**: Destination system
- **Object Type**: Incident, Asset, User, etc.
- **Fields Mapped**: Number of mapped fields
- **Status**: Active, Inactive

## Create New Mapping

From the *Select Actions* drop-down list, choose **New Mapping**. The New Mapping window displays.

### Basic Information

**Mapping Details**:

- **Mapping Name**: ServiceNow Incident Mapping
- **Description**: Maps incidents between Virima and ServiceNow
- **Integration**: Select associated integration
- **Status**: ☑ Active

### Object Selection

**Source and Target**:

- **Source System**: Virima
- **Source Object**: Incident
- **Target System**: ServiceNow
- **Target Object**: Incident

### Field Mapping

Configure individual field mappings:

**Standard Field Mappings**:

| Virima Field | Direction | ServiceNow Field | Transform |
|--------------|-----------|------------------|-----------|
| Number | ↔ | number | Direct |
| Title | ↔ | short_description | Direct |
| Description | ↔ | description | Direct |
| Priority | ↔ | priority | Value Map |
| Status | ↔ | state | Value Map |
| Category | → | category | Value Map |
| Assigned To | ↔ | assigned_to | User Lookup |
| Created Date | → | sys_created_on | Date Format |
| Updated Date | ↔ | sys_updated_on | Date Format |

**Direction Options**:

- → (One-way: Source to Target)
- ← (One-way: Target to Source)
- ↔ (Bi-directional)

### Add Field Mapping

Click **Add Field Mapping**.

**Configure Mapping**:

1. **Select Source Field**: Choose from dropdown
2. **Select Target Field**: Choose from dropdown
3. **Direction**: Select sync direction
4. **Transformation Type**: Choose transformation

**Transformation Types**:

- **Direct Copy**: No transformation
- **Value Mapping**: Map values (e.g., priorities)
- **Formula**: Apply formula/calculation
- **Concatenation**: Combine multiple fields
- **Split**: Split field into multiple fields
- **Lookup**: Reference lookup table
- **Script**: Custom JavaScript/Python
- **Date Format**: Convert date formats
- **User Mapping**: Map user identities

Click **Save Mapping**.

## Value Mapping

Configure value transformations:

### Priority Value Mapping

Map priority values between systems:

**Virima Priority → ServiceNow Priority**:

| Virima Value | ServiceNow Value |
|--------------|------------------|
| Critical | 1 - Critical |
| High | 2 - High |
| Medium | 3 - Moderate |
| Low | 4 - Low |

**Bidirectional Mapping**:

Configure reverse mapping for bi-directional sync:

| ServiceNow Value | Virima Value |
|------------------|--------------|
| 1 - Critical | Critical |
| 2 - High | High |
| 3 - Moderate | Medium |
| 4 - Low | Low |
| 5 - Planning | Low |

**Default Value**:

- If value not found: Map to "Medium"
- Handle null values: Set to default

### Status Value Mapping

**Virima Status → ServiceNow State**:

| Virima Status | ServiceNow State |
|---------------|------------------|
| New | 1 - New |
| In Progress | 2 - In Progress |
| On Hold | 3 - On Hold |
| Resolved | 6 - Resolved |
| Closed | 7 - Closed |
| Cancelled | 8 - Canceled |

### Category Value Mapping

**Mapping with Hierarchy**:

| Virima Category | ServiceNow Category | Subcategory |
|-----------------|---------------------|-------------|
| Hardware > Server | Hardware | Server |
| Hardware > Network | Hardware | Network Device |
| Software > Application | Software | Business Application |
| Service > Email | Service Request | Email |

## User Mapping

Map user identities between systems:

### User Lookup Configuration

**Lookup Method**:

- **By Email**: Match users by email address (recommended)
- **By Username**: Match by username
- **By Employee ID**: Match by employee/HR ID
- **By Full Name**: Match by name (less reliable)
- **Custom Mapping Table**: Manual user mapping

**Email Matching Example**:

```
Virima User: john.doe@company.com
ServiceNow User: john.doe@company.com
Match: ✓ Automatic
```

**Manual User Mapping Table**:

| Virima User | ServiceNow User |
|-------------|-----------------|
| john.doe@company.com | john.doe |
| jane.smith@company.com | jane.m.smith |
| admin@virima.local | virima.integration |

**Unmatched Users**:

- Assign to default user
- Create new user (if permissions allow)
- Leave blank
- Sync fails with error

## Date and Time Mapping

Configure date/time transformations:

### Date Format Conversion

**Source Format**: MM/DD/YYYY HH:mm:ss

**Target Format**: YYYY-MM-DD HH:mm:ss

**Timezone Handling**:

- Convert from UTC to local
- Convert from local to UTC
- Preserve timezone
- Ignore timezone

**Example**:

```
Virima: 01/27/2024 14:30:00 EST
ServiceNow: 2024-01-27 19:30:00 (UTC)
```

## Formula Transformations

Create custom formulas for field transformations:

### Concatenation Formula

**Combine Fields**:

```
Target Field: Full Address
Formula: {{street}} + ", " + {{city}} + ", " + {{state}} + " " + {{zip}}
Result: "123 Main St, Boston, MA 02101"
```

### Calculation Formula

**Calculate Priority Score**:

```
Target Field: Priority Score
Formula: ({{impact}} * 3) + ({{urgency}} * 2)
Result: Numeric score
```

### Conditional Formula

**Set Category Based on Condition**:

```
Target Field: Category
Formula: IF({{priority}} == "Critical", "High Priority", "Normal")
Result: Conditional value
```

## Script Transformations

Advanced transformations using scripts:

### JavaScript Transformation

**Extract Domain from Email**:

```javascript
// Input: email field
// Output: domain field

function transform(input) {
  if (input.email && input.email.includes('@')) {
    return input.email.split('@')[1];
  }
  return '';
}
```

**Custom Status Mapping**:

```javascript
function transformStatus(sourceStatus) {
  const statusMap = {
    'New': 1,
    'In Progress': 2,
    'Resolved': 6,
    'Closed': 7
  };
  
  return statusMap[sourceStatus] || 1;
}
```

### Python Transformation

**Parse and Transform Description**:

```python
def transform_description(desc):
    # Remove HTML tags
    import re
    clean = re.sub('<[^<]+?>', '', desc)
    
    # Truncate to 1000 chars
    return clean[:1000]
```

## Complex Mappings

### One-to-Many Mapping

**Single Source Field to Multiple Target Fields**:

**Split Full Name**:

```
Source: Full Name = "John Doe"
Targets:
  - First Name = "John"
  - Last Name = "Doe"
```

### Many-to-One Mapping

**Multiple Source Fields to Single Target**:

**Combine Address Fields**:

```
Sources:
  - Street = "123 Main St"
  - City = "Boston"
  - State = "MA"
Target: Address = "123 Main St, Boston, MA"
```

### Nested Object Mapping

**Map Complex Structures**:

```json
Source (Virima):
{
  "assigned_user": {
    "name": "John Doe",
    "email": "john@company.com",
    "department": "IT"
  }
}

Target (ServiceNow):
{
  "assigned_to": "john@company.com",
  "assignment_group": "IT Support"
}
```

## Conditional Mapping

Apply mappings based on conditions:

### Condition-Based Field Selection

**Map Different Fields Based on Ticket Type**:

```
IF ticket_type == "Incident":
  Map to incident table
ELSE IF ticket_type == "Request":
  Map to request table
ELSE:
  Skip mapping
```

### Conditional Value Mapping

**Set Priority Based on Multiple Factors**:

```
IF impact == "High" AND urgency == "High":
  priority = "Critical"
ELSE IF impact == "High" OR urgency == "High":
  priority = "High"
ELSE:
  priority = "Medium"
```

## Test Mapping

Test mappings before activation:

Click **Test Mapping**.

### Test Data

**Provide Sample Source Data**:

```json
{
  "number": "INC-12345",
  "title": "Server not responding",
  "priority": "Critical",
  "status": "New",
  "assigned_to": "john.doe@company.com"
}
```

Click **Transform**.

### Preview Results

**Transformed Target Data**:

```json
{
  "number": "INC-12345",
  "short_description": "Server not responding",
  "priority": "1",
  "state": "1",
  "assigned_to": "john.doe"
}
```

**Validation**:

- ✓ All required fields mapped
- ✓ Value transformations correct
- ✓ User lookup successful
- ✓ No data loss

## Mapping Templates

Use pre-built mapping templates:

**Available Templates**:

- ServiceNow Incident Mapping
- Jira Issue Mapping
- Azure DevOps Work Item Mapping
- Salesforce Case Mapping
- Generic ITSM Mapping

**Clone and Customize**:

Select template, clone, and modify for your needs.

## Export/Import Mappings

**Export Mapping Configuration**:

```json
{
  "mapping_name": "ServiceNow Incident",
  "source": "Virima",
  "target": "ServiceNow",
  "fields": [
    {
      "source_field": "title",
      "target_field": "short_description",
      "direction": "bidirectional",
      "transform": "direct"
    }
  ]
}
```

**Import Mapping**: Upload JSON configuration

## Other Functions and Page Elements

- [Auto Refresh](/common_topics/auto_refresh_ng.mdx)
- [Delete](/common_topics/delete_remove_ng.mdx)
- [Export](/discovery/import_data_files/export_ng.mdx)
- [Import](/common_topics/import_ng.mdx)
- [Personalize Columns](/common_topics/personalize_columns_ng.mdx)
- [Saved Filters](/common_topics/saved_filters_ng.mdx)
