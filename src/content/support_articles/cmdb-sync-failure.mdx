---
articleId: K000246103
title: CMDB Synchronization Fails with ServiceNow Integration
published: September 10, 2024
modified: December 02, 2025
category: Integration
severity: High
type: Problem
tags: [cmdb, servicenow, integration, synchronization, data]
excerpt: CMDB sync job fails when attempting to synchronize asset data between Virima and ServiceNow CMDB.
---

# CMDB Synchronization Fails with ServiceNow Integration

**Article ID:** K000246103  
**Last Modified:** December 02, 2025  
**Category:** Integration  
**Severity:** High

---

## Issue

CMDB synchronization job fails when attempting to synchronize asset data between Virima platform and ServiceNow CMDB. Sync status shows "Failed" or "Partial Success" with errors in the sync log.

## Environment

- **Product:** Virima CMDB Sync Connector for ServiceNow
- **Versions:** Virima 6.1+, ServiceNow Paris, Quebec, Rome, San Diego, Tokyo, Utah
- **Integration Type:** Bidirectional CMDB synchronization
- **Authentication:** OAuth 2.0, Basic Authentication

## Symptoms

- CMDB sync job status shows "Failed" in Virima dashboard
- ServiceNow CMDB data not updating with Virima discoveries
- Sync logs show error messages related to authentication, field mapping, or data validation
- Some records sync successfully while others fail (partial sync)
- Duplicate CI records created in ServiceNow
- Sync job runs longer than expected and times out

**Common Error Messages:**
```
Error: Invalid field mapping - field 'u_custom_field' does not exist in target table
Error: Authentication failed - invalid credentials or expired token
Error: Duplicate CI detected - sys_id conflict
Error: ACL Exception - insufficient permissions to update cmdb_ci_server table
Error: Sync timeout - operation exceeded maximum duration of 3600 seconds
```

## Cause

CMDB sync failures can occur due to:

1. **Authentication Issues**
   - Expired OAuth tokens
   - Invalid or rotated credentials
   - Insufficient ServiceNow user permissions
   - MFA/2FA blocking automated authentication

2. **Field Mapping Problems**
   - Custom fields not present in target ServiceNow instance
   - Field type mismatches (string vs. reference field)
   - Required fields missing in mapping configuration
   - Field validation rules not met

3. **Data Quality Issues**
   - Null or invalid values in required fields
   - Data format incompatibility (dates, numbers, JSON)
   - String length exceeds ServiceNow field limits
   - Special characters causing validation errors

4. **ServiceNow ACL Restrictions**
   - Integration user lacks write permissions on CI tables
   - Row-level security preventing updates
   - Business rules blocking automated updates
   - Workflow restrictions

5. **Network and Connectivity**
   - Firewall blocking outbound HTTPS to ServiceNow instance
   - ServiceNow instance unreachable or in maintenance mode
   - Proxy configuration issues
   - SSL certificate validation failures

6. **Configuration Errors**
   - Incorrect ServiceNow instance URL
   - Wrong CI table mapping
   - Sync schedule misconfigured
   - Transform script errors

## Resolution

### Step 1: Verify Authentication

**Check OAuth Token:**
```bash
# Test ServiceNow authentication
curl -X GET "https://your-instance.service-now.com/api/now/table/cmdb_ci_server?sysparm_limit=1" \
  -H "Authorization: Bearer YOUR_OAUTH_TOKEN" \
  -H "Accept: application/json"
```

**If authentication fails, regenerate OAuth token:**

1. Log in to ServiceNow instance
2. Navigate to **System OAuth → Application Registry**
3. Locate Virima OAuth application
4. Click **Regenerate Client Secret**
5. Update Virima integration configuration:
   - Go to **Virima → Settings → Integrations → ServiceNow**
   - Click **Edit Configuration**
   - Update OAuth credentials
   - Click **Test Connection**
   - Save changes

**Verify ServiceNow User Permissions:**

Required roles for integration user:
- `itil`
- `import_set_loader`
- `import_transformer`
- `rest_api_explorer`
- `cmdb_write` (or specific CI table write permissions)

```javascript
// Run in ServiceNow Scripts - Background
var user = gs.getUser();
gs.info('User: ' + user.getName());
gs.info('Roles: ' + user.getRoles());

// Check specific table access
var gr = new GlideRecord('cmdb_ci_server');
gs.info('Can Read: ' + gr.canRead());
gs.info('Can Write: ' + gr.canWrite());
gs.info('Can Create: ' + gr.canCreate());
```

### Step 2: Review and Fix Field Mappings

**Export current mapping configuration:**

1. Go to **Virima → Settings → Integrations → ServiceNow**
2. Navigate to **Field Mappings** tab
3. Click **Export Mapping** (JSON format)

**Verify field existence in ServiceNow:**

```javascript
// ServiceNow Scripts - Background
// Check if field exists
var tableName = 'cmdb_ci_server';
var fieldName = 'u_custom_field';

var td = new GlideTableDescriptor(tableName);
if (td.isValid()) {
    var fields = td.getElementNames();
    var fieldExists = false;
    
    for (var i = 0; i < fields.size(); i++) {
        if (fields.get(i) == fieldName) {
            fieldExists = true;
            break;
        }
    }
    
    gs.info('Field ' + fieldName + ' exists: ' + fieldExists);
    
    if (fieldExists) {
        var element = td.getElement(fieldName);
        gs.info('Field Type: ' + element.getED().getInternalType());
        gs.info('Max Length: ' + element.getED().getLength());
        gs.info('Mandatory: ' + element.getED().isMandatory());
    }
}
```

**Update mapping for non-existent fields:**

Remove or update mappings for fields that don't exist in target instance:

```json
{
  "field_mappings": [
    {
      "source_field": "hostname",
      "target_field": "name",
      "required": true
    },
    {
      "source_field": "ip_address",
      "target_field": "ip_address",
      "required": true
    },
    {
      "source_field": "operating_system",
      "target_field": "os",
      "required": false
    }
    // Remove mapping for non-existent u_custom_field
  ]
}
```

### Step 3: Validate Data Quality

**Query Virima assets with data quality issues:**

```sql
-- Check for assets with null required fields
SELECT asset_id, hostname, ip_address, os
FROM assets
WHERE (hostname IS NULL OR hostname = '')
   OR (ip_address IS NULL OR ip_address = '')
   AND sync_enabled = true;

-- Check for assets with invalid IP addresses
SELECT asset_id, hostname, ip_address
FROM assets
WHERE ip_address NOT REGEXP '^([0-9]{1,3}\.){3}[0-9]{1,3}$'
   AND sync_enabled = true;

-- Check for assets with oversized field values
SELECT asset_id, hostname, LENGTH(description) as desc_length
FROM assets
WHERE LENGTH(description) > 4000  -- ServiceNow field limit
   AND sync_enabled = true;
```

**Clean up data before sync:**

```python
import re

def validate_and_clean_asset_data(asset):
    """Validate and clean asset data before sync"""
    
    # Ensure required fields
    if not asset.get('hostname'):
        asset['hostname'] = f"unknown-{asset['asset_id']}"
    
    # Validate IP address format
    ip = asset.get('ip_address', '')
    if not re.match(r'^(\d{1,3}\.){3}\d{1,3}$', ip):
        asset['ip_address'] = None
    
    # Truncate long strings
    if asset.get('description') and len(asset['description']) > 4000:
        asset['description'] = asset['description'][:3997] + '...'
    
    # Remove special characters from CI name
    if asset.get('name'):
        asset['name'] = re.sub(r'[^\w\s-]', '', asset['name'])
    
    # Ensure valid date formats
    if asset.get('install_date'):
        try:
            # Convert to ServiceNow date format
            asset['install_date'] = asset['install_date'].strftime('%Y-%m-%d')
        except:
            asset['install_date'] = None
    
    return asset
```

### Step 4: Configure ServiceNow ACLs

**Grant integration user access to CI tables:**

1. In ServiceNow, navigate to **System Security → Access Control (ACL)**
2. Create new ACL rule:
   - **Type:** record
   - **Operation:** write
   - **Name:** cmdb_ci_server
   - **Role:** x_virima_integration_user (custom role)
3. Add script condition if needed:
   ```javascript
   // Allow writes from Virima integration user
   answer = gs.getUser().getName() == 'virima_integration';
   ```

**Alternatively, add user to existing ACL:**

```javascript
// Add user to cmdb_write role
var user = new GlideRecord('sys_user');
if (user.get('user_name', 'virima_integration')) {
    var roleGrant = new GlideRecord('sys_user_has_role');
    roleGrant.initialize();
    roleGrant.user = user.sys_id;
    roleGrant.role = gs.getRoleId('cmdb_write');
    roleGrant.insert();
    gs.info('Added cmdb_write role to virima_integration user');
}
```

### Step 5: Check Network Connectivity

**Test connectivity from Virima to ServiceNow:**

```bash
# Test HTTPS connectivity
curl -v -X GET "https://your-instance.service-now.com/api/now/table/sys_user?sysparm_limit=1" \
  -u "username:password" \
  -H "Accept: application/json"

# Check SSL certificate
openssl s_client -connect your-instance.service-now.com:443 -servername your-instance.service-now.com

# Test through proxy (if applicable)
curl -x http://proxy.company.com:8080 \
  -v -X GET "https://your-instance.service-now.com/api/now/table/sys_user?sysparm_limit=1" \
  -u "username:password"
```

**Configure proxy in Virima (if needed):**

1. Go to **Settings → System → Network Configuration**
2. Enable **Use Proxy Server**
3. Configure proxy settings:
   - **Proxy Host:** proxy.company.com
   - **Proxy Port:** 8080
   - **Proxy Authentication:** (if required)
4. Test connection

### Step 6: Review Sync Configuration

**Verify ServiceNow integration settings:**

1. Go to **Virima → Settings → Integrations → ServiceNow**
2. Verify configuration:
   - **Instance URL:** https://your-instance.service-now.com (no trailing slash)
   - **Authentication Method:** OAuth 2.0 (recommended)
   - **Sync Direction:** Bidirectional / One-way
   - **CI Tables:** Correct table mapping
   - **Sync Schedule:** Appropriate frequency

3. **CI Table Mapping should include:**

| Virima Asset Type | ServiceNow CI Table |
|-------------------|---------------------|
| Server | cmdb_ci_server |
| Virtual Machine | cmdb_ci_vm_instance |
| Network Device | cmdb_ci_netgear |
| Storage Device | cmdb_ci_storage_device |
| Database | cmdb_ci_database |
| Application | cmdb_ci_application |

### Step 7: Enable Detailed Logging

**Enable debug logging in Virima:**

1. Go to **Settings → System → Logging**
2. Add new log configuration:
   - **Component:** Integration.ServiceNow
   - **Log Level:** DEBUG
   - **Duration:** 24 hours
3. Run sync job again
4. Review logs: **System → Logs → Integration Logs**

**Enable logging in ServiceNow:**

```javascript
// System Logs → System Log → Integrations
// Or create debug log
var log = new GlideRecord('syslog');
log.initialize();
log.source = 'VirimaIntegration';
log.level = 'debug';
log.message = 'Virima sync debugging enabled';
log.insert();
```

### Step 8: Handle Duplicate CIs

**Configure deduplication strategy:**

1. In Virima, go to **Settings → Integrations → ServiceNow → Advanced**
2. Set **Deduplication Strategy:**
   - **Match on:** Serial Number + Name
   - **Action on Duplicate:** Update existing
   - **CI Identifier:** Use ServiceNow sys_id

**Clean up existing duplicates in ServiceNow:**

```javascript
// ServiceNow Scripts - Background
// Find duplicate servers by serial number
var duplicates = {};
var gr = new GlideRecord('cmdb_ci_server');
gr.addNotNullQuery('serial_number');
gr.query();

while (gr.next()) {
    var sn = gr.getValue('serial_number');
    if (!duplicates[sn]) {
        duplicates[sn] = [];
    }
    duplicates[sn].push({
        sys_id: gr.getValue('sys_id'),
        name: gr.getValue('name'),
        updated: gr.getValue('sys_updated_on')
    });
}

// Report duplicates
for (var serial in duplicates) {
    if (duplicates[serial].length > 1) {
        gs.info('Duplicate CIs with serial: ' + serial);
        for (var i = 0; i < duplicates[serial].length; i++) {
            gs.info('  - ' + duplicates[serial][i].name + ' (' + duplicates[serial][i].sys_id + ')');
        }
    }
}
```

### Step 9: Optimize Sync Performance

**For large sync jobs, implement batching:**

1. Go to **Settings → Integrations → ServiceNow → Performance**
2. Configure batch settings:
   - **Batch Size:** 100 records (default 500)
   - **Batch Delay:** 5 seconds
   - **Max Sync Duration:** 1 hour
   - **Retry Failed Records:** Yes (max 3 attempts)

**Monitor sync performance:**

```sql
-- Check sync job statistics
SELECT 
    job_id,
    start_time,
    end_time,
    TIMESTAMPDIFF(MINUTE, start_time, end_time) as duration_minutes,
    total_records,
    successful_records,
    failed_records,
    (successful_records * 100.0 / total_records) as success_rate
FROM sync_jobs
WHERE integration = 'ServiceNow'
ORDER BY start_time DESC
LIMIT 10;
```

### Step 10: Manual Sync Retry

**Retry failed records manually:**

1. Go to **Integrations → ServiceNow → Sync Jobs**
2. Select failed sync job
3. Click **View Failed Records**
4. Select records to retry
5. Click **Retry Selected Records**
6. Monitor retry job status

**Or retry via API:**

```bash
curl -X POST "https://your-virima-instance.com/api/v3/integrations/servicenow/sync/retry" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "job_id": "sync-job-12345",
    "retry_failed_only": true
  }'
```

## Verification

After resolving sync issues:

1. Sync job status should show "Completed" with 100% success rate
2. Asset counts match between Virima and ServiceNow
3. Sample CIs in ServiceNow show correct data from Virima
4. No error messages in sync logs
5. Sync completes within expected timeframe

**Verify sync results:**

```javascript
// ServiceNow - Query recently synced CIs
var gr = new GlideRecord('cmdb_ci_server');
gr.addQuery('sys_updated_on', '>', gs.daysAgo(1));
gr.addQuery('sys_updated_by', 'virima_integration');
gr.orderByDesc('sys_updated_on');
gr.query();

gs.info('CIs updated by Virima in last 24 hours: ' + gr.getRowCount());

while (gr.next()) {
    gs.info(gr.getValue('name') + ' - ' + gr.getValue('serial_number'));
}
```

## Best Practices

1. **Schedule syncs during off-peak hours** to minimize performance impact
2. **Start with one-way sync** (Virima → ServiceNow) before enabling bidirectional
3. **Test with small dataset** before full production sync
4. **Use OAuth 2.0** instead of basic authentication
5. **Monitor sync job metrics** regularly
6. **Set up sync failure alerts** to catch issues early
7. **Document custom field mappings** for future reference
8. **Maintain separate integration users** for different systems

## Additional Information

### Supported ServiceNow Versions

| ServiceNow Version | Virima Support Status |
|--------------------|----------------------|
| Utah | Fully Supported |
| Tokyo | Fully Supported |
| San Diego | Fully Supported |
| Rome | Fully Supported |
| Quebec | Limited Support (ends June 2025) |
| Paris | Deprecated (ends Dec 2024) |

### Related Articles

- [K000246104: Configuring ServiceNow Integration in Virima](/kb/servicenow-configuration)
- [K000246105: Field Mapping Best Practices](/kb/field-mapping-best-practices)
- [K000246106: Troubleshooting ServiceNow Authentication](/kb/servicenow-authentication)
- [K000246107: CMDB Data Quality Guidelines](/kb/cmdb-data-quality)

### Support Contact

If sync issues persist, contact Virima Support:

- **Support Portal:** support.virima.com
- **Email:** support@virima.com
- **Phone:** +1-800-XXX-XXXX

**Include with support request:**
- Sync job ID and logs
- ServiceNow version and instance URL
- Field mapping configuration (JSON export)
- Sample failed record data
- ServiceNow user roles and permissions

---

**Was this article helpful?**  
[Yes] [No]

*Last updated: December 02, 2025*
